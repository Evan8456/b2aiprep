<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Directory Viewer</title>
    <style>
        /* Basic styles for the file structure */
        .file-structure {
            list-style-type: none;
            padding-left: 20px;
        }

        .file-structure li {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .folder {
            font-weight: bold;
            cursor: pointer;
        }

        .file {
            font-style: italic;
        }

        .description, .file-content {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            display: none; /* Hidden by default */
        }

        .explanation-button {
            margin-left: 10px;
            padding: 2px 5px;
            font-size: 12px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>GitHub Directory Viewer</h1>
    <ul id="file-structure" class="file-structure"></ul>

    <div id="description" class="description"></div>
    <div id="file-content" class="file-content"></div>

    <script>
        // Commit hash to be used in API requests
        const commitHash = '945c5621180fc82dc010ed50f9651139099ece1b';

        async function fetchGitHubRepoContents(repo, path = '', ref = commitHash) {
            const url = `https://api.github.com/repos/${repo}/contents/${path}?ref=${ref}`;
            console.log(`Fetching: ${url}`); // Debugging line
            const response = await fetch(url);
            if (!response.ok) {
                console.error('Failed to fetch repository contents:', response.statusText);
                document.getElementById('file-structure').textContent = `Error: ${response.statusText}`;
                return [];
            }
            try {
                const files = await response.json();
                console.log('Fetched files:', files); // Debugging line
                return files;
            } catch (error) {
                console.error('Failed to parse JSON:', error);
                document.getElementById('file-structure').textContent = `Failed to parse JSON: ${error}`;
                return [];
            }
        }

        async function fetchFileContent(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Failed to fetch file content: ${response.statusText}`);
                }
                const content = await response.text();
                return content;
            } catch (error) {
                console.error('Error fetching file content:', error);
                return `Error fetching file content: ${error}`;
            }
        }

        async function toggleExplanation(file) {
            const description = document.getElementById('description');
            const fileContentBox = document.getElementById('file-content');

            // Show the explanation
            description.textContent = `Explanation for ${file.type}: ${file.name}`;
            description.style.display = 'block';

            // Show the file content if it's a file
            if (file.type === 'file') {
                const content = await fetchFileContent(file.download_url);
                fileContentBox.textContent = `Contents of ${file.name}:\n\n${content}`;
                fileContentBox.style.display = 'block';
            } else {
                fileContentBox.style.display = 'none';
            }
        }

        function renderFiles(files, container) {
            container.innerHTML = '';
            files.forEach(file => {
                const li = document.createElement('li');
                li.className = file.type === 'dir' ? 'folder' : 'file';

                const textSpan = document.createElement('span');
                textSpan.textContent = file.name;
                textSpan.className = li.className;

                const explanationButton = document.createElement('button');
                explanationButton.textContent = 'Explanation';
                explanationButton.className = 'explanation-button';
                explanationButton.addEventListener('click', () => toggleExplanation(file));

                li.appendChild(textSpan);
                li.appendChild(explanationButton);

                if (file.type === 'dir') {
                    textSpan.addEventListener('click', async () => {
                        const subFiles = await fetchGitHubRepoContents('sensein/b2aiprep', file.path, commitHash);
                        const ul = document.createElement('ul');
                        ul.className = 'file-structure';
                        renderFiles(subFiles, ul);
                        if (li.nextElementSibling && li.nextElementSibling.tagName === 'UL') {
                            li.parentNode.removeChild(li.nextElementSibling);
                        } else {
                            li.insertAdjacentElement('afterend', ul);
                        }
                    });
                }

                container.appendChild(li);
            });
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const repo = 'sensein/b2aiprep'; // The GitHub repository
            const path = 'data/b2ai-data-bids-like-template'; // The specific directory path
            const files = await fetchGitHubRepoContents(repo, path, commitHash);
            if (files.length === 0) {
                document.getElementById('file-structure').textContent = 'No files found or failed to load directory contents.';
            } else {
                const fileStructureContainer = document.getElementById('file-structure');
                renderFiles(files, fileStructureContainer);
            }
        });
    </script>
</body>
</html>
