<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Directory Viewer</title>
    <style>
        /* Basic styles for the file structure */
        .file-structure {
            list-style-type: none;
            padding-left: 20px;
        }

        .file-structure li {
            margin: 5px 0;
        }

        .folder {
            font-weight: bold;
            cursor: pointer;
        }

        .file {
            font-style: italic;
        }

        .description {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            display: none; /* Hidden by default */
        }
    </style>
</head>
<body>
    <h1>GitHub Directory Viewer</h1>
    <ul id="file-structure" class="file-structure"></ul>

    <div id="description" class="description"></div>

    <script>
        // Commit hash to be used in API requests
        const commitHash = '945c5621180fc82dc010ed50f9651139099ece1b';

        async function fetchGitHubRepoContents(repo, path = '', ref = commitHash) {
            const url = `https://api.github.com/repos/${repo}/contents/${path}?ref=${ref}`;
            console.log(`Fetching: ${url}`); // Debugging line
            const response = await fetch(url);
            if (!response.ok) {
                console.error('Failed to fetch repository contents:', response.statusText);
                document.getElementById('file-structure').textContent = `Error: ${response.statusText}`;
                return [];
            }
            try {
                const files = await response.json();
                console.log('Fetched files:', files); // Debugging line
                return files;
            } catch (error) {
                console.error('Failed to parse JSON:', error);
                document.getElementById('file-structure').textContent = `Failed to parse JSON: ${error}`;
                return [];
            }
        }

        function renderFiles(files, container) {
            container.innerHTML = '';
            files.forEach(file => {
                const li = document.createElement('li');
                li.textContent = file.name;
                li.className = file.type === 'dir' ? 'folder' : 'file';
                if (file.type === 'dir') {
                    li.addEventListener('click', async () => {
                        const subFiles = await fetchGitHubRepoContents('sensein/b2aiprep', file.path, commitHash);
                        const ul = document.createElement('ul');
                        ul.className = 'file-structure';
                        renderFiles(subFiles, ul);
                        if (li.nextElementSibling && li.nextElementSibling.tagName === 'UL') {
                            li.parentNode.removeChild(li.nextElementSibling);
                        } else {
                            li.insertAdjacentElement('afterend', ul);
                        }
                    });
                } else {
                    li.addEventListener('click', () => {
                        document.getElementById('description').textContent = `File: ${file.name}\nType: ${file.type}\nURL: ${file.html_url}`;
                        document.getElementById('description').style.display = 'block';
                    });
                }
                container.appendChild(li);
            });
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const repo = 'sensein/b2aiprep'; // The GitHub repository
            const path = 'data/b2ai-data-bids-like-template'; // The specific directory path
            const files = await fetchGitHubRepoContents(repo, path, commitHash);
            if (files.length === 0) {
                document.getElementById('file-structure').textContent = 'No files found or failed to load directory contents.';
            } else {
                const fileStructureContainer = document.getElementById('file-structure');
                renderFiles(files, fileStructureContainer);
            }
        });
    </script>
</body>
</html>
